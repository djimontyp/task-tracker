# Довідник конфігурації

**Останнє оновлення:** 26 жовтня 2025
**Статус:** Повна довідка
**Аудиторія:** Користувачі, що керують правилами автоматизації

## Зміст

1. [Налаштування розкладу](#налаштування-розкладу)
2. [Правила авто-затвердження](#правила-авто-затвердження)
3. [Шаблони правил](#шаблони-правил)
4. [Параметри сповіщень](#параметри-сповіщень)
5. [Розширена конфігурація](#розширена-конфігурація)

## Налаштування розкладу

Розклад визначає, **коли** версії оцінюються та обробляються.

### Попередні налаштування

#### Щодня о 9 ранку

```
Час: Щодня о 9:00 ранку
Cron: 0 9 * * *
Найкраще для: Команд з 1-2 сеансами перегляду на день
Обсяг: 10-50 версій на день
```

#### Кожні 6 годин

```
Час: 12:00, 6:00, 12:00, 18:00
Cron: 0 */6 * * *
Найкраще для: Безперервної обробки протягом дня
Обсяг: 30-100 версій на день
```

#### Щогодини

```
Час: Кожну годину о XX:00
Cron: 0 * * * *
Найкраще для: Систем з високим обсягом
Обсяг: 100+ версій на день
```

### Користувальницькі Cron вирази

#### Синтаксис Cron

```
┌─────────────── хвилина (0-59)
│ ┌───────────── година (0-23)
│ │ ┌─────────── день місяця (1-31)
│ │ │ ┌───────── місяць (1-12)
│ │ │ │ ┌─────── день тижня (0-7)
│ │ │ │ │
* * * * *
```

#### Символи Cron

| Символ | Значення | Приклад |
|--------|----------|---------|
| `*` | Будь-яке значення | `*` = кожна хвилина |
| `,` | Список значень | `0,30` = в :00 і :30 |
| `-` | Діапазон значень | `9-17` = 9 ранку до 17:00 |
| `/` | Значення кроку | `*/6` = кожні 6 годин |

#### Популярні приклади Cron

```cron
0 9 * * *          # Щодня о 9 ранку
0 9 * * 1-5        # Будні дні о 9 ранку
0 */6 * * *        # Кожні 6 годин
0 9,17 * * *       # О 9 ранку і 17:00
0 0 * * 1          # Кожного понеділка о 00:00
```

#### Валідація Cron

✅ **Дійсні**
```
0 9 * * *      # Щодня о 9 ранку
0 */6 * * *    # Кожні 6 годин
0 9 * * 1-5    # Будні дні о 9 ранку
```

❌ **Неправильні**
```
60 * * * *     # Хвилина поза межами (макс 59)
* 25 * * *     # Година поза межами (макс 23)
```

## Правила авто-затвердження

Правила визначають **що** схвалюється та **як**.

### Структура правила

```
Умови (ЯКЩО)
   ↓
   Логіка оцінювання (І/АБО)
   ↓
   Дія (ТОДІ)
```

**Приклад правила:**
```
ЯКЩО впевненість >= 80 І схожість >= 70
ТОДІ затвердити
```

### Оцінювання версій

Коли створюється нова версія, Task Tracker витягує ці поля:

| Поле | Тип | Діапазон | Опис |
|------|-----|---------|------|
| `confidence` | Число | 0-100 | Впевненість ШІ у змінах (%) |
| `similarity` | Число | 0-100 | Подібність до існуючого контенту (%) |
| `topic_count` | Ціле число | 0-1000 | Визначених пов'язаних топіків |
| `topic.name` | Рядок | N/A | Назва топіка |
| `source` | Рядок | N/A | Канал джерела (наприклад, "telegram") |

### Оператори умов

#### Для чисел (confidence, similarity, topic_count)

| Оператор | Символ | Значення | Приклад |
|----------|--------|----------|---------|
| Більше або дорівнює | `>=` | Щонайменше цінність | `confidence >= 80` |
| Менше або дорівнює | `<=` | Максимум це значення | `similarity <= 70` |
| Дорівнює | `==` | Точно це значення | `topic_count == 5` |
| Не дорівнює | `!=` | Будь-яке значення крім цього | `topic_count != 0` |

#### Для тексту (topic.name, source)

| Оператор | Символ | Значення | Приклад |
|----------|--------|----------|---------|
| Містить | `contains` | Текст де-небудь | `topic.name contains "urgent"` |
| Дорівнює | `equals` | Точне збігання | `source equals "telegram"` |
| Починається з | `starts_with` | Текст на початку | `topic.name starts_with "Bug"` |

### Логічні оператори

#### Логіка І (Строгіша)

```
ЯКЩО впевненість >= 90 І схожість >= 80
ТОДІ затвердити
```

**Результат:** Обидві умови мають бути істинні.

**Використовуйте коли:** Потрібна висока якість затвердження.

#### Логіка АБО (М'якша)

```
ЯКЩО впевненість >= 95 АБО схожість >= 90
ТОДІ затвердити
```

**Результат:** Одна з умов може бути істинною.

**Використовуйте коли:** Потрібна обробка більше версій.

### Дії

#### Затвердити

```
ЯКЩО умови збігаються
ТОДІ негайно застосувати зміни
```

**Ефект:**
- Зміни версії застосовані до головної сутності
- Версія позначена як затверджена
- Запис додано до журналу аудиту
- WebSocket трансляція для оновлення числа очікування

#### Відхилити

```
ЯКЩО умови збігаються
ТОДІ відкинути версію без застосування
```

**Ефект:**
- Версія позначена як переглянута, але не застосована
- Оригінальна сутність без змін
- Запис додано до журналу аудиту

#### Ручна перевірка

```
ЯКЩО умови збігаються
ТОДІ відправити до черги ручної перевірки
```

**Ефект:**
- Версія залишається очікуючою
- Користувач бачить сповіщення

## Шаблони правил

### Шаблон 1: Авто-затвердження високої впевненості

**Найкраще для:** Консервативних команд, зосереджених на якості

```json
{
  "name": "Авто-затвердження високої впевненості",
  "conditions": [
    {"field": "confidence", "operator": ">=", "value": 90},
    {"field": "similarity", "operator": ">=", "value": 85}
  ],
  "logic": "AND",
  "action": "approve",
  "enabled": true
}
```

**Метрики:**
- Рівень затвердження: ~60-70% версій
- Рівень помилок: <5% (дуже безпечно)
- Ручна перевірка потрібна: 30-40%

### Шаблон 2: Збалансоване авто-затвердження

**Найкраще для:** Зростаючих команд, середнього обсягу

```json
{
  "name": "Збалансоване авто-затвердження",
  "conditions": [
    {"field": "confidence", "operator": ">=", "value": 80},
    {"field": "similarity", "operator": ">=", "value": 70}
  ],
  "logic": "AND",
  "action": "approve",
  "enabled": true
}
```

**Метрики:**
- Рівень затвердження: ~75-85% версій
- Рівень помилок: 5-10% (прийнятно)
- Ручна перевірка потрібна: 15-25%

### Шаблон 3: Агресивне авто-затвердження

**Найкраще для:** Систем з високим рівнем впевненості

```json
{
  "name": "Агресивне авто-затвердження",
  "conditions": [
    {"field": "confidence", "operator": ">=", "value": 70},
    {"field": "similarity", "operator": ">=", "value": 60}
  ],
  "logic": "AND",
  "action": "approve",
  "enabled": true
}
```

**Метрики:**
- Рівень затвердження: ~90%+ версій
- Рівень помилок: 10-15% (потрібен моніторинг)
- Ручна перевірка потрібна: 5-10%

### Шаблон 4: Авто-відхилення низької якості

```json
{
  "name": "Авто-відхилення низької якості",
  "conditions": [
    {"field": "confidence", "operator": "<", "value": 50}
  ],
  "action": "reject",
  "enabled": true
}
```

**Ефект:** Версії з <50% впевненості автоматично відкинені

### Шаблон 5: Ескалація термінових топіків

```json
{
  "name": "Ескалація термінових топіків",
  "conditions": [
    {"field": "topic.name", "operator": "contains", "value": "urgent"}
  ],
  "action": "manual",
  "enabled": true
}
```

**Ефект:** Топіки, що містять "urgent", вимагають ручної перевірки

## Параметри сповіщень

### Налаштування електронної пошти

1. Перейдіть до **Параметри → Сповіщення → Електронна пошта**
2. Введіть вашу адресу електронної пошти
3. Клацніть "Надіслати тестовий лист" для перевірки
4. Виберіть частоту дайджесту

#### Опції дайджесту

| Частота | Доставка | Вміст |
|---------|----------|-------|
| Щогодинно | Кожну годину | Статистика останньої години |
| Щодня | 9 ранку | Резюме вчора |
| Щотижня | Понеділок 9 ранку | Резюме останніх 7 днів |
| Вимкнено | Немає | Листи не надсилаються |

### Налаштування Telegram

1. Перейдіть до **Параметри → Сповіщення → Telegram**
2. Клацніть "Налаштувати бота Telegram"
3. Дотримуйтеся майстра створення бота
4. Скопіюйте токен бота до параметрів

#### Пороги сповіщень

| Поріг | Тригер | Використання |
|-------|--------|-------------|
| Очікування >= 20 | Занадто багато в черзі | Попередження про великий відставання |
| Рівень відхилення > 15% | Попередження якості | Моніторинг помилок |
| Помилки завдання | Помилка завдання | Перевірка помилок планувальника |

### Сповіщення в додатку

Завжди включено. Значок сповіщення на панелі приладів показує кількість незавершених версій.

## Розширена конфігурація

### Стратегія кількох правил

#### Трирівнева стратегія

```
Рівень 1: Авто-затвердження високої впевненості
├─ Умова: впевненість >= 90 І схожість >= 85
└─ Дія: затвердити

Рівень 2: Авто-відхилення низької якості
├─ Умова: впевненість < 50
└─ Дія: відхилити

Рівень 3: Все інше
├─ Умова: (завжди збігається)
└─ Дія: ручна перевірка
```

**Результат:**
- Топ 60%: Авто-затверджено (90%+ впевненості)
- Дно 20%: Авто-відхилено (< 50% впевненості)
- Середина 20%: Ручна перевірка (50-90% впевненості)

### Правила для конкретних топіків

```
Правило 1: Термінові топіки (Пріоритет 1)
├─ Умова: topic.name містить "urgent"
└─ Дія: ручна перевірка (ескалація)

Правило 2: Низька якість (Пріоритет 2)
├─ Умова: впевненість < 50
└─ Дія: відхилити

Правило 3: Висока якість (Пріоритет 3)
├─ Умова: впевненість >= 85 І схожість >= 80
└─ Дія: затвердити
```

### Поведінка за замовчуванням

Коли жодні правила не збігаються або всі вимкнені:

**За замовчуванням:** Усі версії позначені як очікуючі (потрібна ручна перевірка)

### Журнал аудиту

Кожне рішення автоматизації реєструється:

**Приклад запиту:**
```sql
SELECT created_at, rule_id, action, version_id, confidence, similarity
FROM automation_audit_log
WHERE created_at > NOW() - INTERVAL '24 hours'
ORDER BY created_at DESC
```

## Найкраща практика - підсумок

| Сценарій | Пороги | Логіка | Дія |
|----------|--------|--------|-----|
| Консервативна | 90/85 | І | затвердити |
| Збалансована | 80/70 | І | затвердити |
| Агресивна | 70/60 | І | затвердити |
| Фільтр якості | 50 | N/A | відхилити |
| Ескалація | urgent | АБО | ручна |

**Загальні правила:**
1. Почніть консервативно, коригуйте після тижня даних
2. Використовуйте логіку І для затвердження (безпечніше)
3. Використовуйте логіку АБО для відхилення (швидше)
4. Протестуйте правило з попередньою версією перед увімкненням
5. Контролюйте журналу аудиту для метрик якості

---

**Далі:** Див. [Посібник найкращих практик](automation-best-practices.md) для рекомендацій робочого процесу.
