# Messages

## –ú–µ—Ç–∞

–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ **–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**, –≤–µ—Ä–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ AI-–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—é.

## –¶—ñ–ª—å–æ–≤–∞ –∞—É–¥–∏—Ç–æ—Ä—ñ—è

| –†–æ–ª—å | –ü–æ—Ç—Ä–µ–±–∞ |
|------|---------|
| PM | "–ü–æ–∫–∞–∂–∏ —â–æ —Ä–µ–∞–ª—å–Ω–æ –ø–∏—Å–∞–ª–∏" |
| Team Lead | "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ AI –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞–≤" |

---

## Wireframe

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MESSAGES                                                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ [Search...]                                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏: [–í—Å—ñ] [–¢—ñ–ª—å–∫–∏ Signal x] [–®—É–º –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π]     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ –¢–æ–ø—ñ–∫: [–í—Å—ñ —Ç–æ–ø—ñ–∫–∏ v]    –ê–≤—Ç–æ—Ä: [–í—Å—ñ v]                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  127 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Å—å–æ–≥–æ–¥–Ω—ñ (23 signal, 104 noise)               ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ –ü–µ—Ç—Ä–æ –Ü–≤–∞–Ω–æ–≤                               14:32  [v]    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ -------------------------------------------------------- ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ –ó–Ω–∞–π—à–æ–≤ –±–∞–≥ –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –º–æ–∂—É—Ç—å        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ –∑–∞–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å —á–µ—Ä–µ–∑ Google OAuth. –ü–æ–º–∏–ª–∫–∞ 500.            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ @ Mobile App   Score: 0.87   2 insights                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [–ü–æ–≤'—è–∑–∞–Ω—ñ insights]                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ –ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª–µ–Ω–∫–æ                            14:28  [v]    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ -------------------------------------------------------- ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ @–ü–µ—Ç—Ä–æ, –≥–ª—è–Ω—å –º–æ–∂–µ —Ü–µ –ø–æ–≤'—è–∑–∞–Ω–æ –∑ —Ç–∏–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Google API —è–∫–µ –±—É–ª–æ –≤—á–æ—Ä–∞?                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ @ Mobile App   Score: 0.72                               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ –û–ª–µ–∫—Å–∞–Ω–¥—Ä                                  14:25  [~]    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ -------------------------------------------------------- ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ +1                                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Score: 0.12 (noise)                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  [–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —â–µ...]                                           ‚îÇ
‚îÇ                                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Signal/Noise Classification

| –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è | Score | –Ü–∫–æ–Ω–∫–∞ | –ö–æ–ª—ñ—Ä |
|--------------|-------|--------|-------|
| **Signal** | > 0.65 | ‚úÖ CheckCircle | `success` |
| **Weak Signal** | 0.25 - 0.65 | ‚ö° Zap | `warning` |
| **Noise** | < 0.25 | üîá VolumeX | `muted` |

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### 1. MessageFilters

```tsx
interface MessageFiltersProps {
  search: string;
  onSearchChange: (value: string) => void;

  signalFilter: 'all' | 'signal' | 'noise_hidden';
  onSignalFilterChange: (filter: string) => void;

  topicId: string | null;
  onTopicChange: (id: string | null) => void;

  authorId: string | null;
  onAuthorChange: (id: string | null) => void;
}
```

**Signal filter UI:**
```tsx
<Tabs value={signalFilter} onValueChange={setSignalFilter}>
  <TabsList>
    <TabsTrigger value="all">–í—Å—ñ</TabsTrigger>
    <TabsTrigger value="signal">–¢—ñ–ª—å–∫–∏ Signal</TabsTrigger>
    <TabsTrigger value="noise_hidden">–®—É–º –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π</TabsTrigger>
  </TabsList>
</Tabs>
```

---

### 2. MessageCard

```tsx
interface MessageCardProps {
  id: string;
  authorName: string;
  authorAvatar?: string;
  content: string;
  sentAt: string;
  topicName?: string;
  importanceScore: number;
  noiseClassification: 'signal' | 'weak_signal' | 'noise';
  linkedInsightsCount: number;
  onViewInsights?: () => void;
}
```

**Score indicator:**
```tsx
function ScoreIndicator({ score }: { score: number }) {
  const classification = getClassification(score);

  return (
    <div className="flex items-center gap-1.5">
      {classification === 'signal' && (
        <CheckCircle className="h-4 w-4 text-status-connected" />
      )}
      {classification === 'weak_signal' && (
        <Zap className="h-4 w-4 text-status-validating" />
      )}
      {classification === 'noise' && (
        <VolumeX className="h-4 w-4 text-muted-foreground" />
      )}
      <span className="text-xs text-muted-foreground">
        {score.toFixed(2)}
      </span>
    </div>
  );
}
```

---

### 3. MessageStats

–ü–æ–∫–∞–∑—É—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä—ñ–æ–¥.

```tsx
interface MessageStatsProps {
  total: number;
  signal: number;
  noise: number;
}
```

**UI:**
```tsx
<div className="text-sm text-muted-foreground">
  üìä {total} –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Å—å–æ–≥–æ–¥–Ω—ñ ({signal} signal, {noise} noise)
</div>
```

---

### 4. LinkedInsightsPopover

–ü–æ–∫–∞–∑—É—î –ø–æ–≤'—è–∑–∞–Ω—ñ atoms –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

```tsx
interface LinkedInsightsPopoverProps {
  messageId: string;
  count: number;
}
```

**API:**
```
GET /api/v1/messages/{id}/atoms
Response: {
  atoms: [
    { id, type, title }
  ]
}
```

---

## –§—ñ–ª—å—Ç—Ä–∏

### Signal Filter

| –ó–Ω–∞—á–µ–Ω–Ω—è | –õ–æ–≥—ñ–∫–∞ |
|----------|--------|
| `all` | –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ |
| `signal` | `importance_score >= 0.65` |
| `noise_hidden` | `importance_score >= 0.25` |

### Topic Filter

```
GET /api/v1/topics?has_messages=true
```

### Author Filter

```
GET /api/v1/users?has_messages=true
```

---

## API

### List Messages

```
GET /api/v1/messages
  ?page=1
  &per_page=50
  &search=–±–∞–≥
  &importance_gte=0.65      # signal only
  &topic_id=uuid
  &author_id=uuid
  &sort=-sent_at

Response: {
  items: Message[],
  total: 127,
  stats: {
    signal: 23,
    weak_signal: 45,
    noise: 59
  }
}
```

### Message with Atoms

```
GET /api/v1/messages/{id}?include=atoms

Response: {
  id, content, authorName, sentAt, importanceScore, ...
  atoms: [
    { id, type, title }
  ]
}
```

---

## Real-time Updates

WebSocket –ø—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

```tsx
// useWebSocket hook
useEffect(() => {
  const unsubscribe = subscribeToTopic('messages', (event) => {
    if (event.type === 'message.updated') {
      // Optimistic update or refetch
      queryClient.invalidateQueries(['messages']);
    }
  });

  return unsubscribe;
}, []);
```

---

## Infinite Scroll

–ó–∞–º—ñ—Å—Ç—å pagination ‚Äî load more.

```tsx
const { data, fetchNextPage, hasNextPage, isFetchingNextPage } = useInfiniteQuery({
  queryKey: ['messages', filters],
  queryFn: ({ pageParam = 1 }) => fetchMessages({ ...filters, page: pageParam }),
  getNextPageParam: (lastPage) =>
    lastPage.page < lastPage.pages ? lastPage.page + 1 : undefined,
});

// Intersection Observer –¥–ª—è auto-load
const loadMoreRef = useRef(null);
useIntersectionObserver(loadMoreRef, () => {
  if (hasNextPage && !isFetchingNextPage) {
    fetchNextPage();
  }
});
```

---

## –°—Ç–∞–Ω–∏

### Loading (initial)

```tsx
<div className="space-y-4">
  {[1,2,3,4,5].map(i => (
    <Card key={i}>
      <CardContent className="p-4">
        <div className="flex items-center gap-3 mb-2">
          <Skeleton className="h-8 w-8 rounded-full" />
          <Skeleton className="h-4 w-32" />
          <Skeleton className="h-4 w-16 ml-auto" />
        </div>
        <Skeleton className="h-4 w-full mb-2" />
        <Skeleton className="h-4 w-3/4" />
      </CardContent>
    </Card>
  ))}
</div>
```

### Empty

```tsx
<EmptyState
  icon={MessageSquare}
  title="–ù–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å"
  description="–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å Telegram, —â–æ–± –ø–æ—á–∞—Ç–∏ –∑–±–∏—Ä–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"
  action={<Button>–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏</Button>}
/>
```

### Loading More

```tsx
<div ref={loadMoreRef} className="py-4 text-center">
  {isFetchingNextPage && <Spinner />}
  {!hasNextPage && (
    <p className="text-sm text-muted-foreground">–¶–µ –≤—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</p>
  )}
</div>
```

---

## Responsive

| Breakpoint | Layout |
|------------|--------|
| mobile | Filters collapsed, full width cards |
| tablet | Filters row |
| desktop | Full layout |

---

## –§–∞–π–ª–∏

```
src/pages/MessagesPage/               # –Ü–°–ù–£–Ñ
‚îú‚îÄ‚îÄ index.tsx                         # + Signal/Noise filter
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ MessageCard.tsx               # + Score indicator
‚îÇ   ‚îú‚îÄ‚îÄ MessageFilters.tsx            # –ù–û–í–ò–ô
‚îÇ   ‚îú‚îÄ‚îÄ MessageStats.tsx              # –ù–û–í–ò–ô
‚îÇ   ‚îî‚îÄ‚îÄ LinkedInsightsPopover.tsx     # –ù–û–í–ò–ô
‚îî‚îÄ‚îÄ hooks/
    ‚îî‚îÄ‚îÄ useMessages.ts                # + infinite scroll
```
