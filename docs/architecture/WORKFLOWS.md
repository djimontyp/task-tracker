# Pulse Radar â€” Ğ¢Ğ¸Ğ¿Ğ¾Ğ²Ñ– Workflow

**Ğ’ĞµÑ€ÑÑ–Ñ:** 1.0
**Ğ”Ğ°Ñ‚Ğ°:** 7 Ğ³Ñ€ÑƒĞ´Ğ½Ñ 2025
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Comprehensive

---

## Ğ—Ğ¼Ñ–ÑÑ‚

1. [ĞĞ³Ğ»ÑĞ´ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸](#Ğ¾Ğ³Ğ»ÑĞ´-Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸)
2. [Workflow 1: Ğ†Ğ½Ğ³ĞµÑÑ‚ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ Ğ· Telegram](#workflow-1-Ñ–Ğ½Ğ³ĞµÑÑ‚-Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ-Ğ·-telegram)
3. [Workflow 2: Knowledge Extraction (AI Pipeline)](#workflow-2-knowledge-extraction-ai-pipeline)
4. [Workflow 3: Noise Filtering & Scoring](#workflow-3-noise-filtering--scoring)
5. [Workflow 4: Semantic Search & RAG](#workflow-4-semantic-search--rag)
6. [Workflow 5: Real-time Updates (WebSocket)](#workflow-5-real-time-updates-websocket)
7. [Workflow 6: Version Management & Approval](#workflow-6-version-management--approval)
8. [Workflow 7: Frontend Data Flow](#workflow-7-frontend-data-flow)
9. [Ğ”Ğ¾Ğ²Ñ–Ğ´ĞºĞ°: Ğ¡ĞµÑ€Ğ²Ñ–ÑĞ¸ Ñ‚Ğ° Ñ—Ñ… Ğ·Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ñ–](#Ğ´Ğ¾Ğ²Ñ–Ğ´ĞºĞ°-ÑĞµÑ€Ğ²Ñ–ÑĞ¸-Ñ‚Ğ°-Ñ—Ñ…-Ğ·Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ñ–)

---

## ĞĞ³Ğ»ÑĞ´ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸

### Ğ’Ğ¸ÑĞ¾ĞºĞ¾Ñ€Ñ–Ğ²Ğ½ĞµĞ²Ğ° ÑÑ…ĞµĞ¼Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PULSE RADAR SYSTEM                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   TELEGRAM   â”‚â”€â”€â”€â”€â–¶â”‚   WEBHOOK    â”‚â”€â”€â”€â”€â–¶â”‚      FASTAPI (API)       â”‚   â”‚
â”‚   â”‚   (Ğ´Ğ¶ĞµÑ€ĞµĞ»Ğ¾)  â”‚     â”‚   HANDLER    â”‚     â”‚   â”œâ”€ REST Endpoints     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”œâ”€ WebSocket /ws      â”‚   â”‚
â”‚                                              â”‚   â””â”€ TaskIQ Tasks       â”‚   â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚                   â”‚
â”‚   â”‚    REACT     â”‚â—€â”€â”€â”€â”€â”‚   WEBSOCKET  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚   â”‚  DASHBOARD   â”‚     â”‚   (real-time)â”‚                 â”‚                   â”‚
â”‚   â”‚  â”œâ”€ Zustand  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â–¼                   â”‚
â”‚   â”‚  â””â”€ TanStack â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚     NATS     â”‚            â”‚
â”‚                                                  â”‚  JetStream   â”‚            â”‚
â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                          â”‚                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â–¼                   â”‚
â”‚   â”‚  POSTGRESQL  â”‚â—€â”€â”€â”€â”€â”‚   TASKIQ     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚   â”‚  + pgvector  â”‚     â”‚   WORKER     â”‚                                     â”‚
â”‚   â”‚  â”œâ”€ Messages â”‚     â”‚   â”œâ”€ Scoring â”‚                                     â”‚
â”‚   â”‚  â”œâ”€ Topics   â”‚     â”‚   â”œâ”€ Extract â”‚                                     â”‚
â”‚   â”‚  â”œâ”€ Atoms    â”‚     â”‚   â””â”€ Embed   â”‚                                     â”‚
â”‚   â”‚  â””â”€ Vectors  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚  LLM APIS    â”‚     OpenAI / Ollama                                      â”‚
â”‚   â”‚  â”œâ”€ GPT-4    â”‚     (embeddings + extraction)                           â”‚
â”‚   â”‚  â””â”€ Mistral  â”‚                                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4-ÑˆĞ°Ñ€Ğ¾Ğ²Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 4: DASHBOARD                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ĞĞ³Ñ€ĞµĞ³Ğ¾Ğ²Ğ°Ğ½Ñ– Ñ–Ğ½ÑĞ°Ğ¹Ñ‚Ğ¸, Ñ‚Ñ€ĞµĞ½Ğ´Ğ¸, Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸                         â”‚ â”‚
â”‚ â”‚  ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ğ±Ğ°Ñ‡Ğ¸Ñ‚ÑŒ: Topics, Atoms, Activity Heatmap          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LAYER 3: STRUCTURED ATOMS                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  AI-ĞµĞºÑÑ‚Ñ€Ğ°ĞºÑ†Ñ–Ñ ÑÑƒÑ‚Ğ½Ğ¾ÑÑ‚ĞµĞ¹ (problem, solution, decision, etc.) â”‚ â”‚
â”‚ â”‚  M:N Ğ·Ğ²'ÑĞ·ĞºĞ¸ Ğ¼Ñ–Ğ¶ Atoms â†” Topics â†” Messages                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LAYER 2: SIGNAL/NOISE FILTERING                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  4-Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ğ¸Ğ¹ importance scoring (content, author, time, topic)â”‚ â”‚
â”‚ â”‚  ĞšĞ»Ğ°ÑĞ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ: signal (>0.65) / weak_signal / noise (<0.25)  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LAYER 1: RAW MESSAGES                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Ğ¨Ğ²Ğ¸Ğ´ĞºĞ¸Ğ¹ Ñ–Ğ½Ğ³ĞµÑÑ‚ Ğ· Telegram (webhook)                         â”‚ â”‚
â”‚ â”‚  Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ğ½Ğ½Ñ: content, author, timestamp, source               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Workflow 1: Ğ†Ğ½Ğ³ĞµÑÑ‚ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ Ğ· Telegram

### ĞĞ¿Ğ¸Ñ
ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ· Telegram Ğ¿Ğ¾Ñ‚Ñ€Ğ°Ğ¿Ğ»ÑÑÑ‚ÑŒ Ñƒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ‡ĞµÑ€ĞµĞ· webhook, Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°ÑÑ‚ÑŒÑÑ Ğ² Ğ±Ğ°Ğ·Ñ–, Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ”Ñ‚ÑŒÑÑ ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³ Ñ‚Ğ° (Ğ·Ğ° Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¸) knowledge extraction.

### Ğ”Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TELEGRAM MESSAGE INGESTION WORKFLOW                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚   TELEGRAM   â”‚ ĞĞ¾Ğ²Ğµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ                                         â”‚
â”‚  â”‚     BOT      â”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚         â”‚ HTTP POST /webhook/telegram                                        â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 1: WEBHOOK HANDLER                                          â”‚       â”‚
â”‚  â”‚ Location: app/webhooks/router.py                                 â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  â”œâ”€ Ğ’Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ Telegram JSON payload                             â”‚       â”‚
â”‚  â”‚  â”œâ”€ Ğ’Ğ¸ĞºĞ»Ğ¸Ğº: save_telegram_message.kiq(telegram_data)            â”‚       â”‚
â”‚  â”‚  â””â”€ Return 200 OK (ÑˆĞ²Ğ¸Ğ´ĞºĞ¾, Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºÑƒÑ”Ğ¼Ğ¾ Telegram)               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ NATS Queue: taskiq                                                â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 2: TASKIQ WORKER - save_telegram_message()                  â”‚       â”‚
â”‚  â”‚ Location: app/tasks/ingestion.py:94                              â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  â”œâ”€ Parse Telegram JSON (message_id, text, from, date)          â”‚       â”‚
â”‚  â”‚  â”œâ”€ identify_or_create_user() â†’ User + TelegramProfile          â”‚       â”‚
â”‚  â”‚  â”œâ”€ get_or_create_source() â†’ Source (telegram)                  â”‚       â”‚
â”‚  â”‚  â”œâ”€ Fetch avatar URL from Telegram API (ÑĞºÑ‰Ğ¾ Ğ²Ñ–Ğ´ÑÑƒÑ‚Ğ½Ñ–Ğ¹)        â”‚       â”‚
â”‚  â”‚  â”œâ”€ Create Message entity:                                       â”‚       â”‚
â”‚  â”‚  â”‚   â€¢ external_message_id, content, sent_at                    â”‚       â”‚
â”‚  â”‚  â”‚   â€¢ source_id, author_id, telegram_profile_id                â”‚       â”‚
â”‚  â”‚  â”‚   â€¢ embedding=NULL, importance_score=NULL                    â”‚       â”‚
â”‚  â”‚  â””â”€ db.commit()                                                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ Parallel tasks queued                                             â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â–¼                                     â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ STEP 3A: SCORING        â”‚    â”‚ STEP 3B: CHECK EXTRACTION THRESHOLDâ”‚    â”‚
â”‚  â”‚ score_message_task.kiq()â”‚    â”‚ queue_knowledge_extraction_if_neededâ”‚    â”‚
â”‚  â”‚                         â”‚    â”‚                                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ ImportanceScorer     â”‚    â”‚ â”œâ”€ Count unprocessed (topic=NULL)  â”‚    â”‚
â”‚  â”‚ â”‚  â€¢ content_factor     â”‚    â”‚ â”œâ”€ If count >= 10:                 â”‚    â”‚
â”‚  â”‚ â”‚  â€¢ author_factor      â”‚    â”‚ â”‚   â””â”€ Queue extraction task       â”‚    â”‚
â”‚  â”‚ â”‚  â€¢ temporal_factor    â”‚    â”‚ â””â”€ Else: wait for more messages    â”‚    â”‚
â”‚  â”‚ â”‚  â€¢ topics_factor      â”‚    â”‚                                     â”‚    â”‚
â”‚  â”‚ â”‚                       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚ â”œâ”€ Update Message:      â”‚                                                â”‚
â”‚  â”‚ â”‚  â€¢ importance_score   â”‚                                                â”‚
â”‚  â”‚ â”‚  â€¢ noise_classificationâ”‚                                               â”‚
â”‚  â”‚ â”‚  â€¢ noise_factors      â”‚                                                â”‚
â”‚  â”‚ â””â”€ WebSocket broadcast  â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ websocket.messages topic                                          â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 4: WEBSOCKET BROADCAST                                      â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Worker â†’ NATS (websocket.messages) â†’ API â†’ Browser             â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Event: {                                                        â”‚       â”‚
â”‚  â”‚    "type": "message.updated",                                   â”‚       â”‚
â”‚  â”‚    "data": { id, external_message_id, author_name, persisted }  â”‚       â”‚
â”‚  â”‚  }                                                               â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  React Dashboard:                                                â”‚       â”‚
â”‚  â”‚  â”œâ”€ useWebSocket receives event                                 â”‚       â”‚
â”‚  â”‚  â”œâ”€ upsertMessage() â†’ Zustand store                             â”‚       â”‚
â”‚  â”‚  â””â”€ UI Ğ¾Ğ½Ğ¾Ğ²Ğ»ÑÑ”Ñ‚ÑŒÑÑ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ñ‡Ğ°ÑÑ–                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ñ– Ñ„Ğ°Ğ¹Ğ»Ğ¸

| Ğ¤Ğ°Ğ¹Ğ» | ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ |
|------|------------|
| `app/webhooks/router.py` | Telegram webhook endpoint |
| `app/tasks/ingestion.py:94` | `save_telegram_message()` task |
| `app/services/user_service.py` | `identify_or_create_user()` |
| `app/tasks/scoring.py` | `score_message_task()` |
| `app/services/importance_scorer.py` | 4-factor scoring logic |

---

## Workflow 2: Knowledge Extraction (AI Pipeline)

### ĞĞ¿Ğ¸Ñ
AI-Ğ°Ğ³ĞµĞ½Ñ‚ Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ” Ğ¿Ğ°ĞºĞµÑ‚ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ Ñ– Ğ²Ğ¸Ñ‚ÑĞ³ÑƒÑ” ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¾Ğ²Ğ°Ğ½Ñ– Ğ·Ğ½Ğ°Ğ½Ğ½Ñ: Topics Ñ‚Ğ° Atoms Ğ· Ñ—Ñ… Ğ·Ğ²'ÑĞ·ĞºĞ°Ğ¼Ğ¸.

### Ğ”Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KNOWLEDGE EXTRACTION WORKFLOW                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ TRIGGER: Manual (API) Ğ°Ğ±Ğ¾ Auto (threshold 10+ messages)         â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  POST /api/v1/knowledge/extract                                  â”‚       â”‚
â”‚  â”‚  {                                                               â”‚       â”‚
â”‚  â”‚    "message_ids": [uuid, uuid, ...],  // 10-50 recommended      â”‚       â”‚
â”‚  â”‚    "agent_config_id": "uuid"                                    â”‚       â”‚
â”‚  â”‚  }                                                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ TaskIQ Queue                                                      â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 1: LOAD CONTEXT                                             â”‚       â”‚
â”‚  â”‚ Location: app/tasks/knowledge.py:107                             â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  â”œâ”€ Fetch Message entities by IDs                               â”‚       â”‚
â”‚  â”‚  â”œâ”€ Load AgentConfig (system_prompt, model_name, temperature)   â”‚       â”‚
â”‚  â”‚  â”œâ”€ Load LLMProvider (type, base_url, api_key_encrypted)       â”‚       â”‚
â”‚  â”‚  â””â”€ Decrypt API key via CredentialEncryption                    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ WebSocket: extraction_started                                     â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 2: BUILD PROMPT                                             â”‚       â”‚
â”‚  â”‚ Location: app/services/knowledge/knowledge_orchestrator.py:454   â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Prompt Template:                                                â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚  â”‚ Analyze the following {N} messages and extract knowledge.  â”‚â”‚       â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚       â”‚
â”‚  â”‚  â”‚ Messages:                                                   â”‚â”‚       â”‚
â”‚  â”‚  â”‚ Message 1 (ID: {id}, Author: {author}, Time: {time}):      â”‚â”‚       â”‚
â”‚  â”‚  â”‚ {content}                                                   â”‚â”‚       â”‚
â”‚  â”‚  â”‚ ...                                                         â”‚â”‚       â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚       â”‚
â”‚  â”‚  â”‚ Instructions:                                               â”‚â”‚       â”‚
â”‚  â”‚  â”‚ 1. Identify 1-3 main discussion topics (2-4 words each)    â”‚â”‚       â”‚
â”‚  â”‚  â”‚ 2. Extract atomic knowledge units (problem, solution, etc.)â”‚â”‚       â”‚
â”‚  â”‚  â”‚ 3. Assign each atom to a topic                              â”‚â”‚       â”‚
â”‚  â”‚  â”‚ 4. Create links between related atoms                       â”‚â”‚       â”‚
â”‚  â”‚  â”‚ 5. Provide confidence scores (0.7+ for auto-creation)      â”‚â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 3: LLM CALL (Pydantic AI)                                   â”‚       â”‚
â”‚  â”‚ Location: app/services/knowledge/llm_agents.py                   â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  PydanticAgent(                                                  â”‚       â”‚
â”‚  â”‚    model = OpenAIChatModel("gpt-4") or OllamaModel("mistral"),  â”‚       â”‚
â”‚  â”‚    system_prompt = agent_config.system_prompt,                   â”‚       â”‚
â”‚  â”‚    output_type = KnowledgeExtractionOutput,                      â”‚       â”‚
â”‚  â”‚    output_retries = 5                                            â”‚       â”‚
â”‚  â”‚  )                                                               â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  LLM Response Schema:                                            â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚  â”‚ {                                                           â”‚â”‚       â”‚
â”‚  â”‚  â”‚   "topics": [                                               â”‚â”‚       â”‚
â”‚  â”‚  â”‚     {                                                       â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "name": "Mobile App Development",                     â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "description": "Discussion about...",                 â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "confidence": 0.85,                                   â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "keywords": ["mobile", "iOS", "android"],             â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "related_message_ids": [1, 3, 7]                      â”‚â”‚       â”‚
â”‚  â”‚  â”‚     }                                                       â”‚â”‚       â”‚
â”‚  â”‚  â”‚   ],                                                        â”‚â”‚       â”‚
â”‚  â”‚  â”‚   "atoms": [                                                â”‚â”‚       â”‚
â”‚  â”‚  â”‚     {                                                       â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "type": "problem",                                    â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "title": "App crashes on iOS 17",                     â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "content": "Users report...",                         â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "confidence": 0.9,                                    â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "topic_name": "Mobile App Development",               â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "related_message_ids": [1],                           â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "links_to_atom_titles": ["iOS 17 fix applied"],       â”‚â”‚       â”‚
â”‚  â”‚  â”‚       "link_types": ["solves"]                              â”‚â”‚       â”‚
â”‚  â”‚  â”‚     }                                                       â”‚â”‚       â”‚
â”‚  â”‚  â”‚   ]                                                         â”‚â”‚       â”‚
â”‚  â”‚  â”‚ }                                                           â”‚â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 4: SAVE TO DATABASE                                         â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  4a. save_topics() - Ğ´Ğ»Ñ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ topic:                         â”‚       â”‚
â”‚  â”‚      â”œâ”€ If confidence < 0.7: skip (log warning)                 â”‚       â”‚
â”‚  â”‚      â”œâ”€ If topic exists: create TopicVersion snapshot            â”‚       â”‚
â”‚  â”‚      â””â”€ If new: create Topic with auto icon/color                â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  4b. save_atoms() - Ğ´Ğ»Ñ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ atom:                           â”‚       â”‚
â”‚  â”‚      â”œâ”€ If confidence < 0.7: skip                               â”‚       â”‚
â”‚  â”‚      â”œâ”€ If atom exists: create AtomVersion snapshot              â”‚       â”‚
â”‚  â”‚      â”œâ”€ If new: create Atom + TopicAtom M2M join                â”‚       â”‚
â”‚  â”‚      â””â”€ Store meta: {source: "llm_extraction", message_ids}     â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  4c. link_atoms() - Ğ·Ğ²'ÑĞ·ĞºĞ¸ Ğ¼Ñ–Ğ¶ atoms:                          â”‚       â”‚
â”‚  â”‚      â”œâ”€ Match atom titles â†’ atom IDs                            â”‚       â”‚
â”‚  â”‚      â””â”€ Create AtomLink (solves, supports, contradicts, etc.)   â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  4d. update_messages() - assign topic_id to messages             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ Queue embedding tasks                                             â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 5: GENERATE EMBEDDINGS                                      â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  embed_atoms_batch_task.kiq(atom_ids, provider_id)               â”‚       â”‚
â”‚  â”‚  embed_messages_batch_task.kiq(message_ids, provider_id)         â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  â”œâ”€ EmbeddingService.generate_embedding(text)                   â”‚       â”‚
â”‚  â”‚  â”œâ”€ OpenAI: text-embedding-3-small (1536 dims)                  â”‚       â”‚
â”‚  â”‚  â””â”€ Ollama: model + pad to 1536 dims                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ WebSocket broadcasts (multiple events)                            â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 6: WEBSOCKET NOTIFICATIONS                                  â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Events sent to "knowledge" topic:                               â”‚       â”‚
â”‚  â”‚  â”œâ”€ extraction_completed (summary stats)                        â”‚       â”‚
â”‚  â”‚  â”œâ”€ topic_created (per new topic)                               â”‚       â”‚
â”‚  â”‚  â”œâ”€ atom_created (per new atom)                                 â”‚       â”‚
â”‚  â”‚  â””â”€ version_created (per updated entity)                        â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  React Dashboard receives â†’ invalidates queries â†’ UI refresh    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ñ– Ñ„Ğ°Ğ¹Ğ»Ğ¸

| Ğ¤Ğ°Ğ¹Ğ» | ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ |
|------|------------|
| `app/tasks/knowledge.py:107` | `extract_knowledge_from_messages_task()` |
| `app/services/knowledge/knowledge_orchestrator.py` | Orchestration logic |
| `app/services/knowledge/knowledge_schemas.py` | Pydantic output schemas |
| `app/services/knowledge/llm_agents.py` | `build_model_instance()` |
| `app/services/embedding_service.py` | Vector embedding generation |

---

## Workflow 3: Noise Filtering & Scoring

### ĞĞ¿Ğ¸Ñ
ĞšĞ¾Ğ¶Ğ½Ğµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ” importance_score Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ñ– 4 Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ–Ğ², Ñ‰Ğ¾ Ğ²Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” Ñ‡Ğ¸ Ñ†Ğµ signal (Ğ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ğµ) Ñ‡Ğ¸ noise (ÑˆÑƒĞ¼).

### Ğ”Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      IMPORTANCE SCORING ALGORITHM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  Input: Message entity                                                       â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ FACTOR 1: CONTENT (40% weight)                                    â”‚      â”‚
â”‚  â”‚ Location: app/services/importance_scorer.py                       â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Length scoring:                                                  â”‚      â”‚
â”‚  â”‚  â”œâ”€ < 10 chars    â†’ 0.1 (too short)                              â”‚      â”‚
â”‚  â”‚  â”œâ”€ 10-50 chars   â†’ 0.4                                          â”‚      â”‚
â”‚  â”‚  â”œâ”€ 50-200 chars  â†’ 0.7                                          â”‚      â”‚
â”‚  â”‚  â””â”€ > 200 chars   â†’ 0.9 (detailed content)                       â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Noise keywords (â†’ 0.1-0.15):                                    â”‚      â”‚
â”‚  â”‚  "+1", "lol", "ok", "haha", "yeah", "yep", "nope", "ğŸ‘", "ğŸ‘Œ"   â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Signal keywords (â†’ 0.8-0.95):                                   â”‚      â”‚
â”‚  â”‚  "bug", "error", "issue", "problem", "how", "why", "help",       â”‚      â”‚
â”‚  â”‚  "question", "idea", "proposal", "feature", "critical", "urgent" â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Bonuses:                                                         â”‚      â”‚
â”‚  â”‚  â”œâ”€ Contains "?" â†’ +0.1                                          â”‚      â”‚
â”‚  â”‚  â””â”€ Contains URL or code block â†’ +0.15                           â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ FACTOR 2: AUTHOR (20% weight)                                     â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Based on author's historical average:                            â”‚      â”‚
â”‚  â”‚  â”œâ”€ Avg score > 0.7 â†’ 0.9 (trusted author)                       â”‚      â”‚
â”‚  â”‚  â”œâ”€ Avg score < 0.3 â†’ 0.2 (noisy author)                         â”‚      â”‚
â”‚  â”‚  â””â”€ No history      â†’ 0.5 (neutral)                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ FACTOR 3: TEMPORAL (20% weight)                                   â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Message age:                                                     â”‚      â”‚
â”‚  â”‚  â”œâ”€ < 1 hour   â†’ 0.9 (fresh)                                     â”‚      â”‚
â”‚  â”‚  â”œâ”€ < 24 hours â†’ 0.7                                             â”‚      â”‚
â”‚  â”‚  â”œâ”€ < 7 days   â†’ 0.5                                             â”‚      â”‚
â”‚  â”‚  â””â”€ > 7 days   â†’ 0.3 (stale)                                     â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Active topic bonus:                                              â”‚      â”‚
â”‚  â”‚  â””â”€ > 3 messages in topic last 24h â†’ +0.1                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ FACTOR 4: TOPICS (20% weight)                                     â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Topic activity:                                                  â”‚      â”‚
â”‚  â”‚  â”œâ”€ No topic assigned â†’ 0.4 (general chat)                       â”‚      â”‚
â”‚  â”‚  â”œâ”€ < 10 messages     â†’ 0.4 (low importance)                     â”‚      â”‚
â”‚  â”‚  â”œâ”€ 10-50 messages    â†’ 0.6 (medium)                             â”‚      â”‚
â”‚  â”‚  â””â”€ > 50 messages     â†’ 0.9 (high importance topic)              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ FINAL CALCULATION                                                 â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  importance_score = (content Ã— 0.4) + (author Ã— 0.2) +           â”‚      â”‚
â”‚  â”‚                     (temporal Ã— 0.2) + (topics Ã— 0.2)            â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Classification:                                                  â”‚      â”‚
â”‚  â”‚  â”œâ”€ score < 0.25  â†’ "noise"       ğŸ”‡                             â”‚      â”‚
â”‚  â”‚  â”œâ”€ score â‰¤ 0.65  â†’ "weak_signal" âš¡                             â”‚      â”‚
â”‚  â”‚  â””â”€ score > 0.65  â†’ "signal"      âœ…                             â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Thresholds (optimized Oct 2025, F1=85.2%):                      â”‚      â”‚
â”‚  â”‚  â”œâ”€ noise_threshold: 0.25                                        â”‚      â”‚
â”‚  â”‚  â””â”€ signal_threshold: 0.65                                       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                               â”‚
â”‚  Output:                                                                     â”‚
â”‚  â”œâ”€ Message.importance_score = 0.73                                         â”‚
â”‚  â”œâ”€ Message.noise_classification = "signal"                                 â”‚
â”‚  â””â”€ Message.noise_factors = {                                               â”‚
â”‚       "content": 0.8, "author": 0.6, "temporal": 0.9, "topics": 0.5        â”‚
â”‚     }                                                                        â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Workflow 4: Semantic Search & RAG

### ĞĞ¿Ğ¸Ñ
ĞŸĞ¾ÑˆÑƒĞº Ğ¿Ğ¾ ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡Ğ½Ñ–Ğ¹ ÑÑ…Ğ¾Ğ¶Ğ¾ÑÑ‚Ñ– Ğ· Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½ÑĞ¼ pgvector Ñ‚Ğ° Ğ¿Ğ¾Ğ±ÑƒĞ´Ğ¾Ğ²Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ñƒ Ğ´Ğ»Ñ LLM prompts.

### Ğ”Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SEMANTIC SEARCH WORKFLOW                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 1: QUERY EMBEDDING                                          â”‚       â”‚
â”‚  â”‚ Location: app/services/semantic_search_service.py                â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Input: "How to fix iOS 17 crash?"                              â”‚       â”‚
â”‚  â”‚                     â”‚                                            â”‚       â”‚
â”‚  â”‚                     â–¼                                            â”‚       â”‚
â”‚  â”‚  EmbeddingService.generate_embedding(query_text)                 â”‚       â”‚
â”‚  â”‚                     â”‚                                            â”‚       â”‚
â”‚  â”‚                     â–¼                                            â”‚       â”‚
â”‚  â”‚  query_vector = [0.02, -0.15, 0.87, ...]  (1536 dims)           â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 2: PGVECTOR SIMILARITY SEARCH                               â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  SQL Query:                                                      â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚  â”‚ SELECT m.id, m.content, m.sent_at,                          â”‚â”‚       â”‚
â”‚  â”‚  â”‚        1 - (m.embedding <=> $query_vector) / 2 AS similarityâ”‚â”‚       â”‚
â”‚  â”‚  â”‚ FROM messages m                                             â”‚â”‚       â”‚
â”‚  â”‚  â”‚ WHERE m.embedding IS NOT NULL                               â”‚â”‚       â”‚
â”‚  â”‚  â”‚   AND (m.embedding <=> $query_vector) < (1 - $threshold) * 2â”‚â”‚       â”‚
â”‚  â”‚  â”‚ ORDER BY m.embedding <=> $query_vector                      â”‚â”‚       â”‚
â”‚  â”‚  â”‚ LIMIT 10                                                    â”‚â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Cosine distance math:                                           â”‚       â”‚
â”‚  â”‚  â”œâ”€ pgvector <=> returns: 0 (identical) to 2 (opposite)         â”‚       â”‚
â”‚  â”‚  â”œâ”€ similarity = 1 - (distance / 2)                             â”‚       â”‚
â”‚  â”‚  â””â”€ Range: 0.0 to 1.0                                           â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Thresholds:                                                     â”‚       â”‚
â”‚  â”‚  â”œâ”€ semantic_search: 0.65 (balanced)                            â”‚       â”‚
â”‚  â”‚  â”œâ”€ duplicate_detection: 0.95 (high precision)                  â”‚       â”‚
â”‚  â”‚  â””â”€ exploration: 0.50 (broad search)                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 3: RESULTS                                                  â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  [                                                               â”‚       â”‚
â”‚  â”‚    { id: 42, content: "Fixed iOS 17 crash...", similarity: 0.89},â”‚       â”‚
â”‚  â”‚    { id: 15, content: "iOS issues report...", similarity: 0.76},â”‚       â”‚
â”‚  â”‚    { id: 88, content: "Similar problem on...", similarity: 0.71}â”‚       â”‚
â”‚  â”‚  ]                                                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            RAG CONTEXT BUILDING                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  Location: app/services/rag_context_builder.py                              â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Input: Messages batch for LLM analysis                          â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  messages = [msg1, msg2, msg3, ...]                              â”‚       â”‚
â”‚  â”‚  combined_text = " ".join(m.content[:1000] for m in messages)    â”‚       â”‚
â”‚  â”‚  query_embedding = generate_embedding(combined_text)             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ Parallel vector searches                                          â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â–¼                      â–¼                      â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Similar        â”‚   â”‚ Relevant       â”‚   â”‚ Related            â”‚          â”‚
â”‚  â”‚ Proposals      â”‚   â”‚ Atoms          â”‚   â”‚ Messages           â”‚          â”‚
â”‚  â”‚                â”‚   â”‚                â”‚   â”‚                    â”‚          â”‚
â”‚  â”‚ Past approved  â”‚   â”‚ Knowledge base â”‚   â”‚ Historical context â”‚          â”‚
â”‚  â”‚ task proposals â”‚   â”‚ (approved only)â”‚   â”‚ (exclude current)  â”‚          â”‚
â”‚  â”‚                â”‚   â”‚                â”‚   â”‚                    â”‚          â”‚
â”‚  â”‚ TOP 5          â”‚   â”‚ TOP 5          â”‚   â”‚ TOP 5              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                      â”‚                      â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Output: RAGContext dict                                          â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  {                                                               â”‚       â”‚
â”‚  â”‚    "similar_proposals": [                                        â”‚       â”‚
â”‚  â”‚      {"title": "...", "description": "...", "similarity": 0.85} â”‚       â”‚
â”‚  â”‚    ],                                                            â”‚       â”‚
â”‚  â”‚    "relevant_atoms": [                                           â”‚       â”‚
â”‚  â”‚      {"type": "solution", "title": "...", "similarity": 0.78}   â”‚       â”‚
â”‚  â”‚    ],                                                            â”‚       â”‚
â”‚  â”‚    "related_messages": [                                         â”‚       â”‚
â”‚  â”‚      {"content": "...", "sent_at": "...", "similarity": 0.72}   â”‚       â”‚
â”‚  â”‚    ],                                                            â”‚       â”‚
â”‚  â”‚    "context_summary": "## Similar Proposals\n- ..."             â”‚       â”‚
â”‚  â”‚  }                                                               â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  â†’ Injected into LLM prompt as additional context               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Workflow 5: Real-time Updates (WebSocket)

### ĞĞ¿Ğ¸Ñ
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” WebSocket + NATS Ğ´Ğ»Ñ real-time Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ÑŒ Ğ¼Ñ–Ğ¶ Worker Ğ¿Ñ€Ğ¾Ñ†ĞµÑĞ°Ğ¼Ğ¸ Ñ‚Ğ° Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ¾Ğ¼.

### Ğ”Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WEBSOCKET EVENT FLOW                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ WORKER PROCESS (TASKIQ)                                          â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  # In task execution:                                            â”‚       â”‚
â”‚  â”‚  await websocket_manager.broadcast("knowledge", {                â”‚       â”‚
â”‚  â”‚      "type": "knowledge.extraction_completed",                   â”‚       â”‚
â”‚  â”‚      "data": {"topics_created": 2, "atoms_created": 5}          â”‚       â”‚
â”‚  â”‚  })                                                              â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  # Since is_worker=True:                                         â”‚       â”‚
â”‚  â”‚  â†’ _broadcast_via_nats("knowledge", message)                     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ NATS Publish: websocket.knowledge                                 â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ NATS JETSTREAM                                                   â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Subjects:                                                       â”‚       â”‚
â”‚  â”‚  â”œâ”€ websocket.agents                                            â”‚       â”‚
â”‚  â”‚  â”œâ”€ websocket.tasks                                             â”‚       â”‚
â”‚  â”‚  â”œâ”€ websocket.providers                                         â”‚       â”‚
â”‚  â”‚  â”œâ”€ websocket.knowledge   â—€â”€â”€â”€â”€ current message                 â”‚       â”‚
â”‚  â”‚  â”œâ”€ websocket.messages                                          â”‚       â”‚
â”‚  â”‚  â”œâ”€ websocket.monitoring                                        â”‚       â”‚
â”‚  â”‚  â””â”€ websocket.metrics                                           â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ NATS Subscribe callback                                           â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ API PROCESS                                                      â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  _handle_nats_message(msg):                                      â”‚       â”‚
â”‚  â”‚    subject = "websocket.knowledge"                               â”‚       â”‚
â”‚  â”‚    topic = "knowledge"                                           â”‚       â”‚
â”‚  â”‚    data = json.loads(msg.data)                                   â”‚       â”‚
â”‚  â”‚    â†’ _broadcast_local(topic, data)                               â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  _broadcast_local():                                             â”‚       â”‚
â”‚  â”‚    1. Add to message_buffer â†’ seq=42                             â”‚       â”‚
â”‚  â”‚    2. message_with_seq = {..., "_seq": 42}                       â”‚       â”‚
â”‚  â”‚    3. For each connection in _connections["knowledge"]:          â”‚       â”‚
â”‚  â”‚       â””â”€ conn.websocket.send_text(json.dumps(...))               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ WebSocket: ws://host/ws                                           â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ BROWSER (React)                                                  â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  useWebSocket hook:                                              â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  ws.onmessage = (event) => {                                     â”‚       â”‚
â”‚  â”‚    const data = JSON.parse(event.data)                           â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚    // Track sequence for reconnection                            â”‚       â”‚
â”‚  â”‚    if (data._seq) lastSeqRef.current[topic] = data._seq          â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚    // Handle by type                                             â”‚       â”‚
â”‚  â”‚    switch (data.type) {                                          â”‚       â”‚
â”‚  â”‚      case 'knowledge.extraction_completed':                      â”‚       â”‚
â”‚  â”‚        queryClient.invalidateQueries(['topics'])                 â”‚       â”‚
â”‚  â”‚        queryClient.invalidateQueries(['atoms'])                  â”‚       â”‚
â”‚  â”‚        toast.success("Extraction completed!")                    â”‚       â”‚
â”‚  â”‚        break                                                     â”‚       â”‚
â”‚  â”‚      case 'message.updated':                                     â”‚       â”‚
â”‚  â”‚        messagesStore.upsertMessage(data.data)                    â”‚       â”‚
â”‚  â”‚        break                                                     â”‚       â”‚
â”‚  â”‚    }                                                             â”‚       â”‚
â”‚  â”‚  }                                                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WebSocket Events Reference

| Topic | Event Type | Payload | Trigger |
|-------|------------|---------|---------|
| **knowledge** | extraction_started | message_count, agent_name | Task start |
| **knowledge** | extraction_completed | topics_created, atoms_created | Task success |
| **knowledge** | topic_created | topic_id, topic_name | Per new topic |
| **knowledge** | atom_created | atom_id, atom_title, atom_type | Per new atom |
| **messages** | message.updated | id, author_name, persisted | After save |
| **messages** | ingestion.progress | job_id, messages_fetched | Per batch |
| **noise_filtering** | message_scored | message_id, importance_score | Per scored |
| **monitoring** | task_started | task_name, task_id | TaskIQ start |
| **monitoring** | task_completed | task_name, duration_ms | TaskIQ end |
| **metrics** | metrics:update | topicQualityScore, noiseRatio | Periodic |

---

## Workflow 6: Version Management & Approval

### ĞĞ¿Ğ¸Ñ
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ” Ğ²ĞµÑ€ÑÑ–Ñ— Topics Ñ‚Ğ° Atoms Ğ´Ğ»Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ñƒ, diff Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ Ñ‚Ğ° workflow Ğ·Ğ°Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ½Ñ.

### Ğ”Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       VERSIONING & APPROVAL WORKFLOW                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ SCENARIO: Topic updated via extraction or manual edit            â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Existing Topic: "Mobile Development"                            â”‚       â”‚
â”‚  â”‚  New data from LLM: name, description, keywords changed          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 1: CREATE VERSION SNAPSHOT                                  â”‚       â”‚
â”‚  â”‚ Location: app/services/versioning_service.py                     â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  versioning_service.create_topic_version(                        â”‚       â”‚
â”‚  â”‚      db=session,                                                 â”‚       â”‚
â”‚  â”‚      topic_id=existing_topic.id,                                 â”‚       â”‚
â”‚  â”‚      data={                                                      â”‚       â”‚
â”‚  â”‚          "name": "Mobile App Development",  # new                â”‚       â”‚
â”‚  â”‚          "description": "Updated description",                   â”‚       â”‚
â”‚  â”‚          "icon": "smartphone",                                   â”‚       â”‚
â”‚  â”‚          "color": "#3B82F6"                                      â”‚       â”‚
â”‚  â”‚      },                                                          â”‚       â”‚
â”‚  â”‚      created_by="knowledge_extraction"                           â”‚       â”‚
â”‚  â”‚  )                                                               â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Creates: TopicVersion record                                    â”‚       â”‚
â”‚  â”‚  â”œâ”€ topic_id: reference to Topic                                â”‚       â”‚
â”‚  â”‚  â”œâ”€ version: auto-incremented (1, 2, 3...)                      â”‚       â”‚
â”‚  â”‚  â”œâ”€ data: JSON snapshot of new values                           â”‚       â”‚
â”‚  â”‚  â”œâ”€ created_by: "knowledge_extraction" | "user:123"             â”‚       â”‚
â”‚  â”‚  â”œâ”€ approved: false (pending review)                            â”‚       â”‚
â”‚  â”‚  â””â”€ created_at: timestamp                                        â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  NOTE: Original Topic NOT modified until approval               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ WebSocket: version_created                                        â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 2: USER REVIEWS IN DASHBOARD                                â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  VersionsPage shows pending versions:                            â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚  â”‚ Topic: Mobile Development                                   â”‚â”‚       â”‚
â”‚  â”‚  â”‚ Version: 3 (pending)                                        â”‚â”‚       â”‚
â”‚  â”‚  â”‚ Created by: knowledge_extraction                            â”‚â”‚       â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚       â”‚
â”‚  â”‚  â”‚ Changes:                                                    â”‚â”‚       â”‚
â”‚  â”‚  â”‚ - name: "Mobile Development" â†’ "Mobile App Development"    â”‚â”‚       â”‚
â”‚  â”‚  â”‚ - description: [diff view]                                  â”‚â”‚       â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚       â”‚
â”‚  â”‚  â”‚ [âœ“ Approve]  [âœ— Reject]                                    â”‚â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ User clicks Approve                                               â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 3: APPROVAL                                                 â”‚       â”‚
â”‚  â”‚ Location: app/api/v1/versions.py                                 â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  POST /api/v1/versions/{entity_type}/{entity_id}/{version}/approveâ”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  versioning_service.approve_version():                           â”‚       â”‚
â”‚  â”‚  1. Mark TopicVersion.approved = true                            â”‚       â”‚
â”‚  â”‚  2. Apply changes to actual Topic entity:                        â”‚       â”‚
â”‚  â”‚     topic.name = version.data["name"]                            â”‚       â”‚
â”‚  â”‚     topic.description = version.data["description"]              â”‚       â”‚
â”‚  â”‚     ...                                                          â”‚       â”‚
â”‚  â”‚  3. Commit transaction                                           â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Alternative: REJECT                                             â”‚       â”‚
â”‚  â”‚  â””â”€ Mark approved=false, add rejection reason                   â”‚       â”‚
â”‚  â”‚  â””â”€ Topic remains unchanged                                     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ STEP 4: AUTOMATION RULES (Optional)                              â”‚       â”‚
â”‚  â”‚ Location: app/services/rule_engine_service.py                    â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  AutomationRule example:                                         â”‚       â”‚
â”‚  â”‚  {                                                               â”‚       â”‚
â”‚  â”‚    "name": "Auto-approve high confidence",                       â”‚       â”‚
â”‚  â”‚    "entity_type": "atom",                                        â”‚       â”‚
â”‚  â”‚    "conditions": [                                               â”‚       â”‚
â”‚  â”‚      {"field": "confidence", "operator": ">=", "value": 0.9}    â”‚       â”‚
â”‚  â”‚    ],                                                            â”‚       â”‚
â”‚  â”‚    "logic_operator": "AND",                                      â”‚       â”‚
â”‚  â”‚    "action": "approve",                                          â”‚       â”‚
â”‚  â”‚    "priority": 10                                                â”‚       â”‚
â”‚  â”‚  }                                                               â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  RuleEngineService.evaluate_version():                           â”‚       â”‚
â”‚  â”‚  â”œâ”€ Load active rules for entity_type                           â”‚       â”‚
â”‚  â”‚  â”œâ”€ Sort by priority DESC                                       â”‚       â”‚
â”‚  â”‚  â”œâ”€ Evaluate conditions against version.data                    â”‚       â”‚
â”‚  â”‚  â””â”€ Execute first matching action (approve/reject/escalate)    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Workflow 7: Frontend Data Flow

### ĞĞ¿Ğ¸Ñ
Ğ¯Ğº Ğ´Ğ°Ğ½Ñ– Ğ· API Ğ¿Ğ¾Ñ‚Ñ€Ğ°Ğ¿Ğ»ÑÑÑ‚ÑŒ Ğ² React ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· TanStack Query Ñ‚Ğ° Zustand.

### Ğ”Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND DATA FLOW                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ LAYER 1: PAGE COMPONENT                                          â”‚       â”‚
â”‚  â”‚ Location: src/pages/TopicsPage/index.tsx                         â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  function TopicsPage() {                                         â”‚       â”‚
â”‚  â”‚    // TanStack Query for server state                            â”‚       â”‚
â”‚  â”‚    const { data, isLoading, error } = useQuery({                 â”‚       â”‚
â”‚  â”‚      queryKey: ['topics', { page, search, sort_by }],            â”‚       â”‚
â”‚  â”‚      queryFn: () => topicService.listTopics(params),             â”‚       â”‚
â”‚  â”‚      staleTime: 5 * 60 * 1000,  // 5 minutes                    â”‚       â”‚
â”‚  â”‚    })                                                            â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚    // Zustand for UI state                                       â”‚       â”‚
â”‚  â”‚    const { sidebarOpen } = useUIStore()                          â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚    return (...)                                                  â”‚       â”‚
â”‚  â”‚  }                                                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ Query triggers fetch                                              â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ LAYER 2: SERVICE CLASS                                           â”‚       â”‚
â”‚  â”‚ Location: src/features/topics/api/topicService.ts                â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  class TopicService {                                            â”‚       â”‚
â”‚  â”‚    async listTopics(params: ListParams): Promise<TopicList> {    â”‚       â”‚
â”‚  â”‚      const response = await apiClient.get(                       â”‚       â”‚
â”‚  â”‚        API_ENDPOINTS.topics,                                     â”‚       â”‚
â”‚  â”‚        { params }                                                â”‚       â”‚
â”‚  â”‚      )                                                           â”‚       â”‚
â”‚  â”‚      return response.data                                        â”‚       â”‚
â”‚  â”‚    }                                                             â”‚       â”‚
â”‚  â”‚  }                                                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ HTTP GET /api/v1/topics?page=1&search=...                        â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ LAYER 3: AXIOS CLIENT                                            â”‚       â”‚
â”‚  â”‚ Location: src/shared/lib/api/client.ts                           â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  const apiClient = axios.create({                                â”‚       â”‚
â”‚  â”‚    baseURL: import.meta.env.VITE_API_BASE_URL || '',            â”‚       â”‚
â”‚  â”‚    headers: { 'Content-Type': 'application/json' }               â”‚       â”‚
â”‚  â”‚  })                                                              â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  // Request/Response interceptors for error handling             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚  â—€â”€â”€â”€â”€â”€â”€â”€ Response â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ LAYER 4: TANSTACK QUERY CACHE                                    â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  QueryClient stores:                                             â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚  â”‚ Cache Key: ['topics', { page: 1, search: '', sort: 'name' }]â”‚â”‚       â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚       â”‚
â”‚  â”‚  â”‚ Data: {                                                     â”‚â”‚       â”‚
â”‚  â”‚  â”‚   items: [Topic, Topic, ...],                               â”‚â”‚       â”‚
â”‚  â”‚  â”‚   total: 25,                                                â”‚â”‚       â”‚
â”‚  â”‚  â”‚   page: 1                                                   â”‚â”‚       â”‚
â”‚  â”‚  â”‚ }                                                           â”‚â”‚       â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚       â”‚
â”‚  â”‚  â”‚ State: { stale: false, lastUpdated: Date }                  â”‚â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Automatic behaviors:                                            â”‚       â”‚
â”‚  â”‚  â”œâ”€ Cache hit â†’ return data immediately                         â”‚       â”‚
â”‚  â”‚  â”œâ”€ Stale â†’ background refetch                                  â”‚       â”‚
â”‚  â”‚  â”œâ”€ Window focus â†’ refetch (disabled in config)                 â”‚       â”‚
â”‚  â”‚  â””â”€ Mutation success â†’ invalidate related queries               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ LAYER 5: COMPONENT RENDER                                        â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  if (isLoading) return <Skeleton />                              â”‚       â”‚
â”‚  â”‚  if (error) return <ErrorBoundary />                             â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  return (                                                        â”‚       â”‚
â”‚  â”‚    <Grid>                                                        â”‚       â”‚
â”‚  â”‚      {data.items.map(topic => (                                  â”‚       â”‚
â”‚  â”‚        <TopicCard key={topic.id} topic={topic} />                â”‚       â”‚
â”‚  â”‚      ))}                                                         â”‚       â”‚
â”‚  â”‚    </Grid>                                                       â”‚       â”‚
â”‚  â”‚  )                                                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â”‚
â”‚                                                                               â”‚
â”‚  MUTATION FLOW (Optimistic Updates)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ User changes topic color                                         â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  const mutation = useMutation({                                  â”‚       â”‚
â”‚  â”‚    mutationFn: ({ topicId, color }) =>                           â”‚       â”‚
â”‚  â”‚      topicService.updateTopicColor(topicId, color),              â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚    onMutate: async ({ topicId, color }) => {                     â”‚       â”‚
â”‚  â”‚      // 1. Cancel in-flight queries                              â”‚       â”‚
â”‚  â”‚      await queryClient.cancelQueries({ queryKey: ['topics'] })   â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚      // 2. Snapshot previous data                                â”‚       â”‚
â”‚  â”‚      const previous = queryClient.getQueryData(['topics', ...])  â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚      // 3. Optimistically update cache                           â”‚       â”‚
â”‚  â”‚      queryClient.setQueryData(['topics', ...], (old) => ({       â”‚       â”‚
â”‚  â”‚        ...old,                                                   â”‚       â”‚
â”‚  â”‚        items: old.items.map(t =>                                 â”‚       â”‚
â”‚  â”‚          t.id === topicId ? { ...t, color } : t                  â”‚       â”‚
â”‚  â”‚        )                                                         â”‚       â”‚
â”‚  â”‚      }))                                                         â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚      return { previous }  // For rollback                        â”‚       â”‚
â”‚  â”‚    },                                                            â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚    onError: (err, vars, context) => {                            â”‚       â”‚
â”‚  â”‚      // 4. Rollback on error                                     â”‚       â”‚
â”‚  â”‚      queryClient.setQueryData(['topics', ...], context.previous) â”‚       â”‚
â”‚  â”‚    },                                                            â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚    onSuccess: () => {                                            â”‚       â”‚
â”‚  â”‚      // 5. Optionally refetch for server confirmation            â”‚       â”‚
â”‚  â”‚      queryClient.invalidateQueries({ queryKey: ['topics'] })     â”‚       â”‚
â”‚  â”‚    }                                                             â”‚       â”‚
â”‚  â”‚  })                                                              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Management Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STATE MANAGEMENT SPLIT                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TANSTACK QUERY (Server State)                               â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  Manages:                                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ API data (topics, atoms, messages, providers, etc.)    â”‚  â”‚
â”‚  â”‚  â”œâ”€ Caching (5 min stale time)                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Background refetching                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Optimistic updates                                      â”‚  â”‚
â”‚  â”‚  â””â”€ Error/loading states                                    â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  Query Keys:                                                 â”‚  â”‚
â”‚  â”‚  ['topics'], ['atoms', 'topic', id], ['messages'], etc.    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ZUSTAND (Client State)                                      â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  uiStore (persisted):                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ sidebarOpen: boolean                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ theme: 'light' | 'dark' | 'system'                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ expandedGroups: Record<string, boolean>                 â”‚  â”‚
â”‚  â”‚  â””â”€ isAdminMode: boolean                                    â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  messagesStore (ephemeral):                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ messages: MessageList[] (WebSocket updates)             â”‚  â”‚
â”‚  â”‚  â”œâ”€ statusByExternalId: Record<string, status>              â”‚  â”‚
â”‚  â”‚  â””â”€ lastUpdatedAt: timestamp                                â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  wizardStore (ephemeral):                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ currentStep: number                                     â”‚  â”‚
â”‚  â”‚  â””â”€ formData: { schedule, rules }                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WEBSOCKET (Real-time Updates)                               â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  useWebSocket hook:                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ Receives events from server                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Updates Zustand stores directly                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Invalidates TanStack Query cache                        â”‚  â”‚
â”‚  â”‚  â””â”€ Triggers toast notifications                            â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  Topics subscribed: messages, knowledge, noise_filtering,   â”‚  â”‚
â”‚  â”‚                     monitoring, metrics                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ”Ğ¾Ğ²Ñ–Ğ´ĞºĞ°: Ğ¡ĞµÑ€Ğ²Ñ–ÑĞ¸ Ñ‚Ğ° Ñ—Ñ… Ğ·Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ñ–

### Backend Services Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SERVICE DEPENDENCY GRAPH                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                      CRUD LAYER                                   â”‚      â”‚
â”‚  â”‚  (Database operations, inherit from BaseCRUD[T])                 â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  BaseCRUD[T]                                                      â”‚      â”‚
â”‚  â”‚    â”œâ”€ MessageCRUD                                                â”‚      â”‚
â”‚  â”‚    â”œâ”€ AtomCRUD                                                   â”‚      â”‚
â”‚  â”‚    â”œâ”€ TopicCRUD                                                  â”‚      â”‚
â”‚  â”‚    â”œâ”€ ProviderCRUD                                               â”‚      â”‚
â”‚  â”‚    â”œâ”€ AgentCRUD                                                  â”‚      â”‚
â”‚  â”‚    â”œâ”€ TaskCRUD                                                   â”‚      â”‚
â”‚  â”‚    â””â”€ AssignmentCRUD                                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â†‘                                                   â”‚
â”‚                          â”‚ uses                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                    BUSINESS LOGIC LAYER                           â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  KnowledgeOrchestrator                                            â”‚      â”‚
â”‚  â”‚    â”œâ”€ uses: AtomCRUD, TopicCRUD, VersioningService               â”‚      â”‚
â”‚  â”‚    â”œâ”€ calls: LLM via Pydantic AI                                 â”‚      â”‚
â”‚  â”‚    â””â”€ broadcasts: WebSocketManager                               â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  EmbeddingService                                                 â”‚      â”‚
â”‚  â”‚    â”œâ”€ uses: MessageCRUD, AtomCRUD                                â”‚      â”‚
â”‚  â”‚    â”œâ”€ calls: OpenAI API / Ollama API                             â”‚      â”‚
â”‚  â”‚    â””â”€ decrypts: CredentialEncryption                             â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  SemanticSearchService                                            â”‚      â”‚
â”‚  â”‚    â”œâ”€ uses: EmbeddingService (for query vectorization)          â”‚      â”‚
â”‚  â”‚    â””â”€ queries: pgvector (cosine similarity)                      â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  RAGContextBuilder                                                â”‚      â”‚
â”‚  â”‚    â”œâ”€ uses: EmbeddingService, SemanticSearchService              â”‚      â”‚
â”‚  â”‚    â””â”€ builds: context dict for LLM prompts                       â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  ImportanceScorer                                                 â”‚      â”‚
â”‚  â”‚    â”œâ”€ reads: Message, Topic, User history                        â”‚      â”‚
â”‚  â”‚    â””â”€ updates: Message.importance_score, classification          â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  VersioningService                                                â”‚      â”‚
â”‚  â”‚    â”œâ”€ creates: TopicVersion, AtomVersion snapshots               â”‚      â”‚
â”‚  â”‚    â””â”€ applies: approved versions to entities                     â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  RuleEngineService                                                â”‚      â”‚
â”‚  â”‚    â”œâ”€ reads: AutomationRule configs                              â”‚      â”‚
â”‚  â”‚    â””â”€ executes: approve/reject/escalate actions                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â†‘                                                   â”‚
â”‚                          â”‚ uses                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                    INFRASTRUCTURE LAYER                           â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  WebSocketManager                                                 â”‚      â”‚
â”‚  â”‚    â”œâ”€ manages: WebSocket connections                             â”‚      â”‚
â”‚  â”‚    â”œâ”€ publishes to: NATS JetStream                               â”‚      â”‚
â”‚  â”‚    â””â”€ relays: Worker â†’ API â†’ Browser                             â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  CredentialEncryption                                             â”‚      â”‚
â”‚  â”‚    â””â”€ Fernet cipher for API key encryption/decryption            â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  ProviderValidator                                                â”‚      â”‚
â”‚  â”‚    â””â”€ validates: OpenAI/Ollama provider connectivity             â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  MetricsBroadcaster                                               â”‚      â”‚
â”‚  â”‚    â””â”€ broadcasts: metrics updates via WebSocket                  â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  TelegramIngestionService                                         â”‚      â”‚
â”‚  â”‚    â””â”€ fetches: historical messages from Telegram API             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key File Locations

| Category | File Path | Purpose |
|----------|-----------|---------|
| **API Entry** | `app/api/v1/router.py` | All 26 routers registered |
| **Main App** | `app/main.py` | FastAPI app, startup/shutdown |
| **Database** | `app/database.py` | AsyncSession, connection pool |
| **Models** | `app/models/*.py` | SQLModel entities |
| **Tasks** | `app/tasks/*.py` | TaskIQ background workers |
| **Services** | `app/services/*.py` | Business logic |
| **Knowledge** | `app/services/knowledge/` | LLM orchestration |
| **WebSocket** | `app/services/websocket_manager.py` | Real-time pub/sub |
| **Config** | `app/config/ai_config.py` | AI thresholds & settings |

---

## ĞŸÑ–Ğ´ÑÑƒĞ¼Ğ¾Ğº

Ğ¦Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ñ–Ñ Ğ¾Ñ…Ğ¾Ğ¿Ğ»ÑÑ” 7 Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¸Ñ… workflow ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸ Pulse Radar:

1. **Ğ†Ğ½Ğ³ĞµÑÑ‚ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ** â€” Telegram â†’ DB â†’ Scoring â†’ WebSocket
2. **Knowledge Extraction** â€” LLM Ğ°Ğ³ĞµĞ½Ñ‚ Ğ²Ğ¸Ñ‚ÑĞ³ÑƒÑ” Topics Ñ‚Ğ° Atoms
3. **Noise Filtering** â€” 4-Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ğ¸Ğ¹ ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³ ĞºĞ»Ğ°ÑĞ¸Ñ„Ñ–ĞºÑƒÑ” signal/noise
4. **Semantic Search** â€” pgvector similarity Ğ´Ğ»Ñ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ Ñ‚Ğ° RAG
5. **Real-time Updates** â€” WebSocket + NATS Ğ´Ğ»Ñ live Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ÑŒ
6. **Version Management** â€” Snapshots, diffs, approval workflows
7. **Frontend Data Flow** â€” TanStack Query + Zustand + WebSocket

ĞšĞ¾Ğ¶ĞµĞ½ workflow Ğ²Ñ–Ğ·ÑƒĞ°Ğ»Ñ–Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ· Ğ´Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ°Ğ¼Ğ¸ Ñ‚Ğ° Ğ¿Ñ€Ğ¸Ğ²'ÑĞ·ĞºĞ°Ğ¼Ğ¸ Ğ´Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ² Ñƒ ĞºĞ¾Ğ´Ğ¾Ğ²Ñ–Ğ¹ Ğ±Ğ°Ğ·Ñ–.

---

*Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ñ– Ğ³Ğ»Ğ¸Ğ±Ğ¾ĞºĞ¾Ğ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·Ñƒ codebase Ğ¿Ñ€Ğ¾Ñ”ĞºÑ‚Ñƒ Pulse Radar.*
