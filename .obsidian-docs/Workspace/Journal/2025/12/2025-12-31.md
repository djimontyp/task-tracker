---
type: journal
date: 2025-12-31
author: maks
tags:
  - journal
---

# 2025-12-31

## Focus

- [ ] P0.2: Виправити race condition Messages
- [ ] Методологія Ralph Wiggum — ітеративний фікс

## Sessions

---

### 17:40 — Ralph Wiggum: Race Condition Fix

**Goal:** Виправити race condition в Messages через Ralph loop methodology

**Issue:** task-tracker-mv1
**Problem:** WebSocket → Zustand, але TanStack Query не інвалідується
**Solution:** Замінити upsertMessage() на queryClient.invalidateQueries(['messages'])

**Plan:**
1. Аналіз issue деталей
2. Запуск Ralph loop з чітким промптом
3. Моніторинг ітерацій
4. Верифікація через MCP (Playwright + Chrome DevTools)

**Done:**
- [x] F1 агент проаналізував та написав фікс
- [x] Замінено Zustand mutations на queryClient.invalidateQueries
- [x] Q1 верифікував: TypeScript ✅, ESLint ✅
- [x] Issue task-tracker-mv1 закрито

**Findings:**
- [[WebSocket + TanStack Query Pattern]] — правильний паттерн для real-time
- Race condition виникає коли WebSocket мутує Zustand напряму
- Рішення: invalidateQueries → background refetch → single source of truth

---

### 17:55 — Batch Migration: Services to Axios (P1.1-P1.8)

**Goal:** Мігрувати всі сервіси на axios паттерн

**Tasks:**
- P1.1: queryKeys constants
- P1.2-P1.8: 7 сервісів (agent, atom, topic, provider, project, noise, task)

**Strategy:** 4 паралельних агенти

**Done:**
- [x] P1.1: queryKeys constants — Agent 1
- [x] P1.2-P1.3: agentService + atomService — Agent 2
- [x] P1.4-P1.5: topicService + providerService — Agent 3
- [x] P1.6-P1.8: projectService + noiseService + taskService — Agent 4
- [x] TypeScript check: passed
- [x] Q1: Final verification — all 8 issues CLOSED

**Findings:**
- [[Axios Migration Pattern]] — fetch → apiClient, auto JSON parsing
- 4 паралельні агенти = ефективна batch робота
- Всі сервіси тепер консистентні з analysisService паттерном

## Notes
