# Feature Specification: i18n Internationalization

**Feature Branch**: `005-i18n`
**Created**: 2025-12-14
**Status**: Draft
**PRD References**: US-034 (UI Language), US-035 (Project Language)

## Clarifications

### Session 2025-12-14

- Q: Яка конкретна метрика для "миттєвої" зміни мови? → A: <100ms (instant feedback)
- Q: Як обробляти якщо AI згенерував контент не тією мовою? → A: Показати контент мовою AI з warning badge

## Overview

Pulse Radar потребує дворівневої локалізації:
1. **UI мова** — інтерфейс користувача (кнопки, меню, системні повідомлення) — per-user налаштування
2. **Project мова** — AI-генерований контент (atoms, summaries) — per-project налаштування

Українська мова за замовчуванням, оскільки цільова аудиторія — українські команди.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Вибір мови інтерфейсу (Priority: P1)

Як користувач, я хочу обрати мову інтерфейсу в налаштуваннях профілю, щоб користуватись системою рідною мовою.

**Why this priority**: Це основа для локалізації. Без можливості перемикати мову UI неможливо забезпечити зручність для різномовних користувачів. Українська команда очікує українську локалізацію.

**Independent Test**: Можна повністю протестувати зміну мови в Settings → Profile та перевірити що весь UI перемикається без перезавантаження сторінки.

**Acceptance Scenarios**:

1. **Given** користувач на сторінці Settings, **When** вибирає "Українська" в налаштуваннях мови, **Then** весь UI миттєво перемикається на українську без перезавантаження
2. **Given** користувач змінив мову на українську, **When** закриває та відкриває браузер знову, **Then** мова залишається українською
3. **Given** новий користувач без налаштувань, **When** заходить в систему вперше, **Then** UI відображається українською (default)

---

### User Story 2 - Вибір мови проєкту (Priority: P2)

Як адміністратор, я хочу обрати мову проєкту при створенні, щоб AI генерував знання цією мовою.

**Why this priority**: Залежить від базової інфраструктури i18n з P1. Визначає мову для AI-генерованого контенту, що критично для якості бази знань.

**Independent Test**: Можна протестувати створення проєкту з вибором мови та перевірити що AI-промпти включають вказану мову.

**Acceptance Scenarios**:

1. **Given** адмін на кроці "Основи проєкту" в онбордингу, **When** вибирає мову "Українська", **Then** проєкт створюється з вказаною мовою
2. **Given** проєкт з мовою "Українська", **When** AI екстрагує atoms з повідомлень, **Then** atoms генеруються українською мовою
3. **Given** проєкт з мовою "Українська", **When** AI генерує summary, **Then** summary генерується українською

---

### User Story 3 - Перегляд source повідомлень в оригіналі (Priority: P3)

Як PM, я хочу бачити оригінальні повідомлення без перекладу, щоб зберегти автентичність джерела.

**Why this priority**: Підтримуюча функція. Sources зберігаються as-is незалежно від мови проєкту — це принципове рішення для збереження контексту.

**Independent Test**: Перевірити що при відкритті source message в modal контент відображається в оригінальній мові, без перекладу.

**Acceptance Scenarios**:

1. **Given** atom з source message англійською, **When** відкриваю деталі atom, **Then** source message відображається англійською (оригінал)
2. **Given** проєкт з мовою "Українська" та source message російською, **When** переглядаю source, **Then** source відображається російською без перекладу

---

### Edge Cases

- Що відбувається якщо користувач не обрав мову? → Використовується українська за замовчуванням
- Що відбувається при зміні мови проєкту? → Існуючі atoms НЕ перекладаються, нові генеруються новою мовою
- Як обробляється змішаний контент (українська + англійська в одному повідомленні)? → Source зберігається as-is, AI екстрагує мовою проєкту
- Що якщо браузер має іншу locale? → Ігнорується, використовується тільки user preference
- Що якщо AI згенерував контент не тією мовою? → Показати контент as-is з warning badge "Мова відрізняється від мови проєкту"

## Requirements *(mandatory)*

### Functional Requirements

#### UI Локалізація (US-034)

- **FR-001**: Система ПОВИННА надавати вибір мови інтерфейсу в Settings / Profile
- **FR-002**: Система ПОВИННА підтримувати українську мову за замовчуванням
- **FR-003**: Система ПОВИННА підтримувати англійську мову як альтернативу
- **FR-004**: Зміна мови ПОВИННА застосовуватись миттєво без перезавантаження сторінки
- **FR-005**: Вибір мови ПОВИНЕН зберігатись в профілі користувача
- **FR-006**: Система ПОВИННА локалізувати: кнопки, лейбли, меню, системні повідомлення, помилки, onboarding підказки

#### Project Локалізація (US-035)

- **FR-007**: Система ПОВИННА запитувати мову проєкту на кроці "Основи проєкту" в онбордингу
- **FR-008**: Мова проєкту ПОВИННА бути українська за замовчуванням
- **FR-009**: AI промпти ПОВИННІ включати мову проєкту для генерації контенту
- **FR-010**: Atoms (title, content, summary) ПОВИННІ генеруватись мовою проєкту
- **FR-011**: Source messages ПОВИННІ зберігатись в оригіналі без перекладу

#### Обмеження

- **FR-012**: Зміна мови проєкту НЕ ПОВИННА перекладати існуючі atoms
- **FR-013**: Система НЕ ПОВИННА автоматично визначати мову з browser locale
- **FR-014**: Якщо AI згенерував контент мовою відмінною від мови проєкту, система ПОВИННА показати контент з warning badge

### Key Entities

- **UserPreferences**: Зберігає обрану мову UI користувача (language_code)
- **Project**: Розширюється полем language_code для мови AI-генерованого контенту
- **LocalizationResources**: Набір перекладів для UI елементів (namespace: ui, errors, onboarding)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 100% UI елементів відображаються обраною мовою користувача
- **SC-002**: Зміна мови відбувається за <100ms без перезавантаження сторінки
- **SC-003**: Мова зберігається між сесіями — при наступному вході залишається попередня
- **SC-004**: AI-генерований контент (atoms, summaries) відповідає мові проєкту у 100% випадків
- **SC-005**: Source messages зберігають оригінальну мову у 100% випадків

## Assumptions

- Початково підтримуються тільки 2 мови: українська (uk) та англійська (en)
- Англійська мова UI буде додана у v1.1+ для SaaS масштабування
- Фокус MVP — українська локалізація
- Переклади UI будуть зберігатись у JSON файлах (/locales/uk.json, /locales/en.json)
- AI промпти будуть мати окремі версії для кожної мови проєкту
